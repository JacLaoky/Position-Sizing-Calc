<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Calculator</title>
    <style>
        :root {
            --bg-color: #ffffff;
            --text-color: #37352f;
            --gray-bg: #f7f6f3;
            --border-color: rgba(55, 53, 47, 0.16);
            --accent: #2eaadc;
        }
        * {
            box-sizing: border-box;
        }
        body {
            font-family: Lyon-Text, Georgia, ui-serif, Cambria, "Times New Roman", Times, serif;
            color: var(--text-color);
            background-color: transparent;
            margin: 0;
            padding: 2px; /* 给阴影留出一点空间 */
            font-size: 14px;
        }
        .container {
            width: 100%; /* 占满 Notion embed 的全宽 */
            background: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
        }
        .tab {
            padding: 6px 16px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            color: rgba(55, 53, 47, 0.6);
            font-weight: 500;
            font-size: 15px;
        }
        .tab.active {
            border-bottom: 2px solid var(--text-color);
            color: var(--text-color);
        }
        .input-group {
            margin-bottom: 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .input-group label {
            color: rgba(55, 53, 47, 0.65);
            font-size: 15px;
        }
        input {
            width: 140px; /* 加宽了输入框 */
            padding: 6px 10px;
            border: 1px solid transparent;
            background: var(--gray-bg);
            border-radius: 4px;
            font-family: inherit;
            color: var(--text-color);
            text-align: right;
            outline: none;
            transition: border 0.2s;
            font-size: 15px;
        }
        input:focus {
            border: 1px solid var(--accent);
            background: #fff;
        }
        .result-box {
            margin-top: 20px;
            padding: 16px;
            background: var(--gray-bg);
            border-radius: 4px;
            font-size: 15px;
            line-height: 1.6;
        }
        .hidden { display: none; }
        .highlight { font-weight: 600; color: #e03e3e; }
        .green { font-weight: 600; color: #0f7b6c; }
        
        /* R:R Targets Grid Styling */
        .rr-title {
            font-size: 13px;
            color: rgba(55, 53, 47, 0.65);
            margin-top: 20px;
            margin-bottom: 12px;
            font-weight: 600;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 6px;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .rr-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* 改为 3 列排版 */
            gap: 12px;
        }
        .rr-card {
            background-color: transparent;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 12px 6px;
            text-align: center;
        }
        .rr-ratio {
            color: rgba(55, 53, 47, 0.65);
            font-size: 13px;
            margin-bottom: 6px;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
        }
        .rr-price {
            color: var(--text-color);
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
        }
        .rr-profit {
            color: #0f7b6c;
            font-size: 13px;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="tabs">
        <div class="tab active" onclick="switchTab('build')">Scale In (1:2:4)</div>
        <div class="tab" onclick="switchTab('swing')">Swing Trade</div>
    </div>

    <div id="build-mode">
        <div class="input-group">
            <label>Capital ($)</label>
            <input type="number" id="b-cap" oninput="calcBuild()">
        </div>
        <div class="input-group">
            <label>Entry Price ($)</label>
            <input type="number" id="b-price" oninput="calcBuild()">
        </div>
        <div class="input-group">
            <label>Target Pos (%)</label>
            <input type="number" id="b-pct" oninput="calcBuild()" placeholder="e.g. 10">
        </div>
        <div class="result-box" id="b-result">
            Enter data to get scale-in plan...
        </div>
    </div>

    <div id="swing-mode" class="hidden">
        <div class="input-group">
            <label>Capital ($)</label>
            <input type="number" id="s-cap" oninput="calcSwing()">
        </div>
        <div class="input-group">
            <label>Max Risk (%)</label>
            <input type="number" id="s-risk" oninput="calcSwing()" value="0.3" step="0.1">
        </div>
        <div class="input-group">
            <label>Entry Price ($)</label>
            <input type="number" id="s-price" oninput="calcSwing()">
        </div>
        <div class="input-group">
            <label>Stop Loss ($)</label>
            <input type="number" id="s-stop" oninput="calcSwing()">
        </div>
        <div class="result-box" id="s-result">
            Enter data to get position size & targets...
        </div>
    </div>
</div>

<script>
    function switchTab(mode) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById('build-mode').classList.add('hidden');
        document.getElementById('swing-mode').classList.add('hidden');
        
        if (mode === 'build') {
            document.querySelectorAll('.tab')[0].classList.add('active');
            document.getElementById('build-mode').classList.remove('hidden');
        } else {
            document.querySelectorAll('.tab')[1].classList.add('active');
            document.getElementById('swing-mode').classList.remove('hidden');
        }
    }

    function calcBuild() {
        let cap = parseFloat(document.getElementById('b-cap').value);
        let price = parseFloat(document.getElementById('b-price').value);
        let pct = parseFloat(document.getElementById('b-pct').value);

        if (cap && price && pct) {
            let totalShares = Math.floor((cap * (pct / 100)) / price);
            let b1 = Math.floor(totalShares * (1/7));
            let b2 = Math.floor(totalShares * (2/7));
            let b3 = Math.floor(totalShares * (4/7));
            
            document.getElementById('b-result').innerHTML = `
                Total: <b>${totalShares} shares</b> ($${(totalShares*price).toFixed(2)})<br>
                1️⃣ Batch 1 (1/7): <span class="green">${b1}</span> shares<br>
                2️⃣ Batch 2 (2/7): <span class="green">${b2}</span> shares<br>
                3️⃣ Batch 3 (4/7): <span class="green">${b3}</span> shares
            `;
        } else {
            document.getElementById('b-result').innerHTML = "Enter data to get scale-in plan...";
        }
    }

    function calcSwing() {
        let cap = parseFloat(document.getElementById('s-cap').value);
        let riskPct = parseFloat(document.getElementById('s-risk').value);
        let price = parseFloat(document.getElementById('s-price').value);
        let stop = parseFloat(document.getElementById('s-stop').value);

        if (cap && riskPct && price && stop) {
            let maxRisk = cap * (riskPct / 100); 
            let riskPerShare = price - stop;
            
            if (riskPerShare <= 0) {
                document.getElementById('s-result').innerHTML = "<span class='highlight'>Stop Loss must be below Entry Price!</span>";
                return;
            }

            let shares = Math.floor(maxRisk / riskPerShare);
            let totalCost = shares * price;
            
            let html = `Max Risk: $${maxRisk.toFixed(2)} (${riskPct}%)<br>`;
            html += `Buy: <span class="green">${shares}</span> shares ($${totalCost.toFixed(2)})<br>`;
            
            // R:R Targets Generation
            html += `<div class="rr-title">Take Profit Targets</div>`;
            html += `<div class="rr-grid">`;
            
            const ratios = [1, 1.5, 2, 3, 4, 5];
            ratios.forEach(r => {
                let targetPrice = price + (riskPerShare * r);
                let profit = shares * (targetPrice - price); 
                
                html += `
                    <div class="rr-card">
                        <div class="rr-ratio">${r}:1 R</div>
                        <div class="rr-price">$${targetPrice.toFixed(2)}</div>
                        <div class="rr-profit">+$${profit.toFixed(2)}</div>
                    </div>
                `;
            });
            
            html += `</div>`;
            
            document.getElementById('s-result').innerHTML = html;
        } else {
            document.getElementById('s-result').innerHTML = "Enter data to get position size & targets...";
        }
    }
</script>
</body>
</html>
