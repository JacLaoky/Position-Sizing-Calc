<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Calculator</title>
    <style>
        :root {
            color-scheme: light dark;
            
            /* Light Mode Variables */
            --bg-color: #ffffff;
            --text-color: #37352f;
            --text-muted: rgba(55, 53, 47, 0.65);
            --gray-bg: #f7f6f3;
            --input-bg: #f7f6f3;
            --input-border: transparent;
            --border-color: rgba(55, 53, 47, 0.16);
            --accent: #2eaadc;
            --green: #0f7b6c;
            --red: #e03e3e;
            --btn-long-bg: #0f7b6c;
            --btn-short-bg: #e03e3e;
            --btn-text: #ffffff;
        }

        /* Dark Mode Variables */
        @media (prefers-color-scheme: dark) {
            :root {
                --bg-color: #191919; 
                --text-color: rgba(255, 255, 255, 0.9);
                --text-muted: rgba(255, 255, 255, 0.5);
                --gray-bg: #202020; 
                --input-bg: rgba(255, 255, 255, 0.08); /* 提亮输入框背景，防止隐形 */
                --input-border: rgba(255, 255, 255, 0.15); /* 增加可见边框 */
                --border-color: rgba(255, 255, 255, 0.13); 
                --accent: #2eaadc;
                --green: #2ebd85; 
                --red: #ff7369;   
                --btn-long-bg: #2ebd85;
                --btn-short-bg: #ff7369;
                --btn-text: #191919; /* 暗色模式下，高亮按钮上的文字用深色更清晰 */
            }
        }

        * {
            box-sizing: border-box;
        }
        
        html, body {
            background-color: transparent; 
            margin: 0;
            padding: 0;
            height: 100%;
        }

        body {
            font-family: Lyon-Text, Georgia, ui-serif, Cambria, "Times New Roman", Times, serif;
            color: var(--text-color);
            padding: 2px;
            font-size: 14px;
        }

        .container {
            width: 100%;
            background: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            transition: background 0.2s, border-color 0.2s; 
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
        }
        .tab {
            padding: 6px 16px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            color: var(--text-muted);
            font-weight: 500;
            font-size: 15px;
            transition: color 0.2s;
        }
        .tab.active {
            border-bottom: 2px solid var(--text-color);
            color: var(--text-color);
        }
        
        /* Long/Short Toggle Button Styling */
        .toggle-group {
            display: flex;
            background: var(--gray-bg);
            border-radius: 6px;
            padding: 4px;
            margin-bottom: 18px;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
            border: 1px solid var(--border-color); 
        }
        .toggle-btn {
            flex: 1;
            text-align: center;
            padding: 6px 0;
            font-size: 13px;
            cursor: pointer;
            color: var(--text-muted);
            border-radius: 4px;
            transition: all 0.2s ease;
        }
        
        /* 针对 Long 和 Short 分别设置高亮颜色 */
        #btn-long.active {
            background: var(--btn-long-bg);
            color: var(--btn-text);
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            font-weight: 600;
        }
        #btn-short.active {
            background: var(--btn-short-bg);
            color: var(--btn-text);
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            font-weight: 600;
        }

        .input-group {
            margin-bottom: 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .input-group label {
            color: var(--text-muted);
            font-size: 15px;
        }
        input {
            width: 140px;
            padding: 6px 10px;
            border: 1px solid var(--input-border);
            background: var(--input-bg);
            border-radius: 4px;
            font-family: inherit;
            color: var(--text-color);
            text-align: right;
            outline: none;
            transition: border 0.2s, background 0.3s;
            font-size: 15px;
        }
        input:focus {
            border: 1px solid var(--accent);
            background: var(--bg-color);
        }
        .result-box {
            margin-top: 20px;
            padding: 16px;
            background: var(--gray-bg);
            border-radius: 4px;
            font-size: 15px;
            line-height: 1.6;
            transition: background 0.3s;
            border: 1px solid var(--border-color); 
        }
        .hidden { display: none; }
        .highlight { font-weight: 600; color: var(--red); }
        .green { font-weight: 600; color: var(--green); }
        .red { font-weight: 600; color: var(--red); }
        
        /* R:R Targets Grid Styling */
        .rr-title {
            font-size: 13px;
            color: var(--text-muted);
            margin-top: 20px;
            margin-bottom: 12px;
            font-weight: 600;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 6px;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .rr-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }
        .rr-card {
            background-color: var(--gray-bg);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 12px 6px;
            text-align: center;
        }
        .rr-ratio {
            color: var(--text-muted);
            font-size: 13px;
            margin-bottom: 6px;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
        }
        .rr-price {
            color: var(--text-color);
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
        }
        .rr-profit {
            color: var(--green);
            font-size: 13px;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="tabs">
        <div class="tab active" onclick="switchTab('build')">Scale In (1:2:4)</div>
        <div class="tab" onclick="switchTab('swing')">Swing Trade</div>
    </div>

    <div id="build-mode">
        <div class="input-group">
            <label>Capital ($)</label>
            <input type="number" id="b-cap" oninput="calcBuild()">
        </div>
        <div class="input-group">
            <label>Entry Price ($)</label>
            <input type="number" id="b-price" oninput="calcBuild()">
        </div>
        <div class="input-group">
            <label>Target Pos (%)</label>
            <input type="number" id="b-pct" oninput="calcBuild()" placeholder="e.g. 10">
        </div>
        <div class="result-box" id="b-result">
            Enter data to get scale-in plan...
        </div>
    </div>

    <div id="swing-mode" class="hidden">
        <div class="toggle-group">
            <div class="toggle-btn active" id="btn-long" onclick="setDirection('long')">Long</div>
            <div class="toggle-btn" id="btn-short" onclick="setDirection('short')">Short</div>
        </div>

        <div class="input-group">
            <label>Capital ($)</label>
            <input type="number" id="s-cap" oninput="calcSwing()">
        </div>
        <div class="input-group">
            <label>Max Risk (%)</label>
            <input type="number" id="s-risk" oninput="calcSwing()" value="0.3" step="0.1">
        </div>
        <div class="input-group">
            <label>Entry Price ($)</label>
            <input type="number" id="s-price" oninput="calcSwing()">
        </div>
        <div class="input-group">
            <label>Stop Loss ($)</label>
            <input type="number" id="s-stop" oninput="calcSwing()">
        </div>
        <div class="result-box" id="s-result">
            Enter data to get position size & targets...
        </div>
    </div>
</div>

<script>
    let swingDirection = 'long'; 

    function switchTab(mode) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById('build-mode').classList.add('hidden');
        document.getElementById('swing-mode').classList.add('hidden');
        
        if (mode === 'build') {
            document.querySelectorAll('.tab')[0].classList.add('active');
            document.getElementById('build-mode').classList.remove('hidden');
        } else {
            document.querySelectorAll('.tab')[1].classList.add('active');
            document.getElementById('swing-mode').classList.remove('hidden');
        }
    }

    function setDirection(dir) {
        swingDirection = dir;
        document.getElementById('btn-long').classList.remove('active');
        document.getElementById('btn-short').classList.remove('active');
        document.getElementById(`btn-${dir}`).classList.add('active');
        calcSwing(); 
    }

    function calcBuild() {
        let cap = parseFloat(document.getElementById('b-cap').value);
        let price = parseFloat(document.getElementById('b-price').value);
        let pct = parseFloat(document.getElementById('b-pct').value);

        if (cap && price && pct) {
            let totalShares = Math.floor((cap * (pct / 100)) / price);
            let b1 = Math.floor(totalShares * (1/7));
            let b2 = Math.floor(totalShares * (2/7));
            let b3 = Math.floor(totalShares * (4/7));
            
            document.getElementById('b-result').innerHTML = `
                Total: <b>${totalShares} shares</b> ($${(totalShares*price).toFixed(2)})<br>
                1️⃣ Batch 1 (1/7): <span class="green">${b1}</span> shares<br>
                2️⃣ Batch 2 (2/7): <span class="green">${b2}</span> shares<br>
                3️⃣ Batch 3 (4/7): <span class="green">${b3}</span> shares
            `;
        } else {
            document.getElementById('b-result').innerHTML = "Enter data to get scale-in plan...";
        }
    }

    function calcSwing() {
        let cap = parseFloat(document.getElementById('s-cap').value);
        let riskPct = parseFloat(document.getElementById('s-risk').value);
        let price = parseFloat(document.getElementById('s-price').value);
        let stop = parseFloat(document.getElementById('s-stop').value);

        if (cap && riskPct && price && stop) {
            let maxRisk = cap * (riskPct / 100); 
            let riskPerShare = swingDirection === 'long' ? (price - stop) : (stop - price);
            
            if (riskPerShare <= 0) {
                let errorMsg = swingDirection === 'long' ? 
                    "Stop Loss must be BELOW Entry Price!" : 
                    "Stop Loss must be ABOVE Entry Price!";
                document.getElementById('s-result').innerHTML = `<span class='highlight'>${errorMsg}</span>`;
                return;
            }

            let shares = Math.floor(maxRisk / riskPerShare);
            let totalCost = shares * price;
            
            let actionText = swingDirection === 'long' ? 
                `Buy: <span class="green">${shares}</span> shares` : 
                `Short: <span class="red">${shares}</span> shares`;
                
            let html = `Max Risk: $${maxRisk.toFixed(2)} (${riskPct}%)<br>`;
            html += `${actionText} ($${totalCost.toFixed(2)})<br>`;
            
            html += `<div class="rr-title">Take Profit Targets</div>`;
            html += `<div class="rr-grid">`;
            
            const ratios = [1, 1.5, 2, 3, 4, 5];
            ratios.forEach(r => {
                let targetPrice = swingDirection === 'long' ? 
                    price + (riskPerShare * r) : 
                    price - (riskPerShare * r);
                
                let profit = shares * Math.abs(targetPrice - price); 
                
                html += `
                    <div class="rr-card">
                        <div class="rr-ratio">${r}:1 R</div>
                        <div class="rr-price">$${targetPrice.toFixed(2)}</div>
                        <div class="rr-profit">+$${profit.toFixed(2)}</div>
                    </div>
                `;
            });
            
            html += `</div>`;
            
            document.getElementById('s-result').innerHTML = html;
        } else {
            document.getElementById('s-result').innerHTML = "Enter data to get position size & targets...";
        }
    }
</script>
</body>
</html>
