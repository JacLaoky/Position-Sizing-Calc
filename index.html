<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Calculator</title>
    <style>
        :root {
            --bg-color: #ffffff;
            --text-color: #37352f;
            --gray-bg: #f7f6f3;
            --border-color: rgba(55, 53, 47, 0.16);
            --accent: #2eaadc;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
            color: var(--text-color);
            background-color: transparent;
            margin: 0;
            padding: 10px;
            font-size: 14px;
        }
        .container {
            max-width: 300px;
            background: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 16px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        .tabs {
            display: flex;
            margin-bottom: 16px;
            border-bottom: 1px solid var(--border-color);
        }
        .tab {
            padding: 4px 12px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            color: rgba(55, 53, 47, 0.6);
            font-weight: 500;
        }
        .tab.active {
            border-bottom: 2px solid var(--text-color);
            color: var(--text-color);
        }
        .input-group {
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .input-group label {
            color: rgba(55, 53, 47, 0.65);
        }
        input {
            width: 80px;
            padding: 4px 8px;
            border: 1px solid transparent;
            background: var(--gray-bg);
            border-radius: 4px;
            font-family: inherit;
            color: var(--text-color);
            text-align: right;
            outline: none;
            transition: border 0.2s;
        }
        input:focus {
            border: 1px solid var(--accent);
            background: #fff;
        }
        .result-box {
            margin-top: 16px;
            padding: 12px;
            background: var(--gray-bg);
            border-radius: 4px;
            font-size: 13px;
            line-height: 1.6;
        }
        .hidden { display: none; }
        .highlight { font-weight: 600; color: #e03e3e; }
        .green { font-weight: 600; color: #0f7b6c; }
    </style>
</head>
<body>

<div class="container">
    <div class="tabs">
        <div class="tab active" onclick="switchTab('build')">建仓 (1:2:4)</div>
        <div class="tab" onclick="switchTab('swing')">Swing (0.3%)</div>
    </div>

    <div id="build-mode">
        <div class="input-group">
            <label>本金 ($)</label>
            <input type="number" id="b-cap" oninput="calcBuild()">
        </div>
        <div class="input-group">
            <label>股价 ($)</label>
            <input type="number" id="b-price" oninput="calcBuild()">
        </div>
        <div class="input-group">
            <label>预计仓位 (%)</label>
            <input type="number" id="b-pct" oninput="calcBuild()" placeholder="e.g. 10">
        </div>
        <div class="result-box" id="b-result">
            输入数据获取分批建仓计划...
        </div>
    </div>

    <div id="swing-mode" class="hidden">
        <div class="input-group">
            <label>本金 ($)</label>
            <input type="number" id="s-cap" oninput="calcSwing()">
        </div>
        <div class="input-group">
            <label>买入价 ($)</label>
            <input type="number" id="s-price" oninput="calcSwing()">
        </div>
        <div class="input-group">
            <label>止损点 ($)</label>
            <input type="number" id="s-stop" oninput="calcSwing()">
        </div>
        <div class="input-group">
            <label>目标价 ($)</label>
            <input type="number" id="s-target" oninput="calcSwing()">
        </div>
        <div class="result-box" id="s-result">
            输入数据获取买入股数及盈亏比...
        </div>
    </div>
</div>

<script>
    function switchTab(mode) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById('build-mode').classList.add('hidden');
        document.getElementById('swing-mode').classList.add('hidden');
        
        if (mode === 'build') {
            document.querySelectorAll('.tab')[0].classList.add('active');
            document.getElementById('build-mode').classList.remove('hidden');
        } else {
            document.querySelectorAll('.tab')[1].classList.add('active');
            document.getElementById('swing-mode').classList.remove('hidden');
        }
    }

    function calcBuild() {
        let cap = parseFloat(document.getElementById('b-cap').value);
        let price = parseFloat(document.getElementById('b-price').value);
        let pct = parseFloat(document.getElementById('b-pct').value);

        if (cap && price && pct) {
            let totalShares = Math.floor((cap * (pct / 100)) / price);
            let b1 = Math.floor(totalShares * (1/7));
            let b2 = Math.floor(totalShares * (2/7));
            let b3 = Math.floor(totalShares * (4/7));
            
            document.getElementById('b-result').innerHTML = `
                总计: <b>${totalShares} 股</b> ($${(totalShares*price).toFixed(2)})<br>
                1️⃣ 第一笔 (1/7): <span class="green">${b1}</span> 股<br>
                2️⃣ 第二笔 (2/7): <span class="green">${b2}</span> 股<br>
                3️⃣ 第三笔 (4/7): <span class="green">${b3}</span> 股
            `;
        }
    }

    function calcSwing() {
        let cap = parseFloat(document.getElementById('s-cap').value);
        let price = parseFloat(document.getElementById('s-price').value);
        let stop = parseFloat(document.getElementById('s-stop').value);
        let target = parseFloat(document.getElementById('s-target').value);

        if (cap && price && stop) {
            // 严格执行 0.3% 风控纪律
            let maxRisk = cap * 0.003; 
            let riskPerShare = price - stop;
            
            if (riskPerShare <= 0) {
                document.getElementById('s-result').innerHTML = "<span class='highlight'>止损价必须低于买入价！</span>";
                return;
            }

            let shares = Math.floor(maxRisk / riskPerShare);
            let totalCost = shares * price;
            
            let html = `最大亏损控制在 $${maxRisk.toFixed(2)} (0.3%)<br>`;
            html += `建议买入: <span class="green">${shares}</span> 股 ($${totalCost.toFixed(2)})<br>`;
            
            if (target > price) {
                let reward = target - price;
                let rr = reward / riskPerShare;
                html += `盈亏比 (R:R): <b>1 : ${rr.toFixed(1)}</b>`;
            }
            
            document.getElementById('s-result').innerHTML = html;
        }
    }
</script>
</body>
</html>
